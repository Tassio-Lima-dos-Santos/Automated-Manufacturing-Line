FUNCTION_BLOCK FB_PRODUCT_QUEUE
VAR_INPUT
    push : BOOL;
    pop  : BOOL;
    peek  : BOOL;
    clear  : BOOL;
    itemIn : ST_PRODUCT;
END_VAR

VAR_OUTPUT
    itemOut : ST_PRODUCT;
    isEmpty : BOOL;
    isFull  : BOOL;
END_VAR

VAR
    buffer : ARRAY[1..100] OF ST_PRODUCT;
    head   : INT := 1;
    tail   : INT := 1;
    count  : INT := 0;
END_VAR

// Enqueue
IF push AND (count < 100) THEN
    buffer[tail] := itemIn;
    tail := (tail MOD 100) + 1;
    count := count + 1;
END_IF;

// Peek
IF peek THEN
    itemOut := buffer[head];
END_IF;

// Dequeue
IF pop AND (count > 0) THEN
    itemOut := buffer[head];
    head := (head MOD 100) + 1;
    count := count - 1;
END_IF;

// Clear
IF clear THEN
    tail := head;
    count := 0;
END_IF;

isEmpty := (count = 0);
isFull  := (count = 100);
